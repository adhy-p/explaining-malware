# explaining-malware
Explaining Malware Behaviours using Graphs - NUS B. Comp. Dissertation Project

## Setting up
The programs (outside Python) used in this project are as follows:
- `IDA Pro v7.6`
- `graphviz`

The Python dependencies can be found in `requirements.txt`.

The steps to install IDA can be found at Hex Rays' website. 
> :warning: **IMPORTANT!** After installing IDA, update the `IDA_PATH` variable in `src/run_me.py`.

To install `graphviz`, run:
```bash
sudo apt install graphviz
```
It is recommended to create a virtual environment before installing the dependencies. To automatically install the (Python) dependencies, run:
```bash
setup.sh
```

## Directory Structure
The directory structure of this project is as follows:
```bash
.
├── inputs
│   └── MALWARE_NAME
├── outputs
│   └── MALWARE_NAME
│       ├── annotated-cfg.svg
│       ├── behavior-graph.svg
│       └── intermediate-outputs
│           ├── capabilities.json
│           ├── cfg.dot
│           └── metadata.json
├── README.md
├── requirements.txt
├── setup.sh
└── src
    ├── behavior_graph_gen.py
    ├── capa_parser.py
    ├── ida_cfg_gen.py
    └── run_me.py
```
Explanation:
- The malware samples (PE/ELF) are located in the `inputs` directory
- The scripts used to generate the behavior graph are located in the `src` directory
- After running the script, the behavior graph is located in the `outputs/{MALWARE_NAME}/behavior-graph.svg`
  - Inside the `outputs/{MALWARE_NAME}` directory, the intermediate outputs generated in the process are preserved.
  - `capabilities.json` : list of malware capabilities generated by `capa`
  - `cfg.dot` : control flow graph of the malware in DOT format
  - `metadata.json` : contains information about the starting address and ending address of each basic block in the cfg.
  - `annotated-cfg.svg` : behavior graph before node removal process

## Running the program
Before running the program, put the malware samples in the `inputs/` directory. Then, go to the `src/` directory and simply type:
> :warning: **IMPORTANT!** The script must be invoked from the `src/` directory. The current version of this project does not handle the path properly.
```bash
python3 run_me.py
```
