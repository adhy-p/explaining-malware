#/usr/bin/python3

import os
import subprocess

MALWARE_DIR = "../inputs/"
INTERMEDIATE_OUTPUT_DIR = "../intermediate-outputs/"
OUTPUT_DIR = "../outputs/"

def process_malware(malware: str):
    # Generate CFG using IDA
    subprocess.run(f"{IDA_PATH} -A -S\"ida_cfg_gen.py {args}\" {MALWARE_DIR}/{malware_file}", shell=True)
    # Generate list of malware capabilities using CAPA
    subprocess.run(f"capa -j {MALWARE_DIR}/{malware}", shell=True)
    # Convert the list of malware capabilities to the correct format
    subprocess.run(f"capa_parser.py {INTERMEDIATE_DIR} {OUTPUT_DIR} {malware}", shell=True)
    # Generate the behavior graph
    subprocess.run(f"python3 behavior_graph_gen.py {malware}", shell=True)


def main():
    for malware in os.listdir(MALWARE_DIR):
        process_malware(malware)

if __name__ == "__main__":
    main()
behavior_graph_gen.py
capa_parser.py
ida_cfg_gen.py
run_me.py
